{"ast":null,"code":"var _jsxFileName = \"/Users/griffin/Desktop/Github/Assana-Mate/Web/src/pages/Yoga/Yoga.js\",\n    _s = $RefreshSig$();\n\nimport * as poseDetection from '@tensorflow-models/pose-detection';\nimport * as tf from '@tensorflow/tfjs';\nimport React, { useRef, useState, useEffect } from 'react';\nimport backend from '@tensorflow/tfjs-backend-webgl';\nimport Webcam from 'react-webcam';\nimport { count } from '../../utils/music';\nimport Instructions from '../../components/Instrctions/Instructions';\nimport DropDown from '../../components/DropDown/DropDown';\nimport { poseImages } from '../../utils/pose_images';\nimport { POINTS, keypointConnections } from '../../utils/data';\nimport { drawPoint, drawSegment } from '../../utils/helper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet skeletonColor = 'rgb(255,255,255)';\nlet poseList = ['Tree', 'Chair', 'Cobra', 'Warrior', 'Dog', 'Shoulderstand', 'Traingle'];\nlet interval;\nlet flag = false;\n\nfunction Yoga() {\n  _s();\n\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [startingTime, setStartingTime] = useState(0);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [poseTime, setPoseTime] = useState(0);\n  const [bestPerform, setBestPerform] = useState(0);\n  const [currentPose, setCurrentPose] = useState('Tree');\n  const [isStartPose, setIsStartPose] = useState(false);\n  useEffect(() => {\n    const timeDiff = (currentTime - startingTime) / 1000;\n\n    if (flag) {\n      setPoseTime(timeDiff);\n    }\n\n    if ((currentTime - startingTime) / 1000 > bestPerform) {\n      setBestPerform(timeDiff);\n    }\n  }, [currentTime]);\n  useEffect(() => {\n    setCurrentTime(0);\n    setPoseTime(0);\n    setBestPerform(0);\n  }, [currentPose]);\n  const CLASS_NO = {\n    Chair: 0,\n    Cobra: 1,\n    Dog: 2,\n    No_Pose: 3,\n    Shoulderstand: 4,\n    Traingle: 5,\n    Tree: 6,\n    Warrior: 7\n  };\n\n  function get_center_point(landmarks, left_bodypart, right_bodypart) {\n    let left = tf.gather(landmarks, left_bodypart, 1);\n    let right = tf.gather(landmarks, right_bodypart, 1);\n    const center = tf.add(tf.mul(left, 0.5), tf.mul(right, 0.5));\n    return center;\n  }\n\n  function get_pose_size(landmarks, torso_size_multiplier = 2.5) {\n    let hips_center = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP);\n    let shoulders_center = get_center_point(landmarks, POINTS.LEFT_SHOULDER, POINTS.RIGHT_SHOULDER);\n    let torso_size = tf.norm(tf.sub(shoulders_center, hips_center));\n    let pose_center_new = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP);\n    pose_center_new = tf.expandDims(pose_center_new, 1);\n    pose_center_new = tf.broadcastTo(pose_center_new, [1, 17, 2]);\n    let d = tf.gather(tf.sub(landmarks, pose_center_new), 0, 0);\n    let max_dist = tf.max(tf.norm(d, 'euclidean', 0));\n    let pose_size = tf.maximum(tf.mul(torso_size, torso_size_multiplier), max_dist);\n    return pose_size;\n  }\n\n  function normalize_pose_landmarks(landmarks) {\n    let pose_center = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP);\n    pose_center = tf.expandDims(pose_center, 1);\n    pose_center = tf.broadcastTo(pose_center, [1, 17, 2]);\n    landmarks = tf.sub(landmarks, pose_center);\n    let pose_size = get_pose_size(landmarks);\n    landmarks = tf.div(landmarks, pose_size);\n    return landmarks;\n  }\n\n  function landmarks_to_embedding(landmarks) {\n    landmarks = normalize_pose_landmarks(tf.expandDims(landmarks, 0));\n    let embedding = tf.reshape(landmarks, [1, 34]);\n    return embedding;\n  }\n\n  const runMovenet = async () => {\n    const detectorConfig = {\n      modelType: poseDetection.movenet.modelType.SINGLEPOSE_THUNDER\n    };\n    const detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet, detectorConfig);\n    const poseClassifier = await tf.loadLayersModel('https://models.s3.jp-tok.cloud-object-storage.appdomain.cloud/model.json');\n    const countAudio = new Audio(count);\n    countAudio.loop = true;\n    interval = setInterval(() => {\n      detectPose(detector, poseClassifier, countAudio);\n    }, 100);\n  };\n\n  const detectPose = async (detector, poseClassifier, countAudio) => {\n    if (typeof webcamRef.current !== 'undefined' && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      let notDetected = 0;\n      const video = webcamRef.current.video;\n      const pose = await detector.estimatePoses(video);\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n\n      try {\n        const keypoints = pose[0].keypoints;\n        let input = keypoints.map(keypoint => {\n          if (keypoint.score > 0.4) {\n            if (!(keypoint.name === 'left_eye' || keypoint.name === 'right_eye')) {\n              drawPoint(ctx, keypoint.x, keypoint.y, 8, 'rgb(255,255,255)');\n              let connections = keypointConnections[keypoint.name];\n\n              try {\n                connections.forEach(connection => {\n                  let conName = connection.toUpperCase();\n                  drawSegment(ctx, [keypoint.x, keypoint.y], [keypoints[POINTS[conName]].x, keypoints[POINTS[conName]].y], skeletonColor);\n                });\n              } catch (err) {}\n            }\n          } else {\n            notDetected += 1;\n          }\n\n          return [keypoint.x, keypoint.y];\n        });\n\n        if (notDetected > 4) {\n          skeletonColor = 'rgb(255,255,255)';\n          return;\n        }\n\n        const processedInput = landmarks_to_embedding(input);\n        const classification = poseClassifier.predict(processedInput);\n        classification.array().then(data => {\n          const classNo = CLASS_NO[currentPose];\n          console.log(data[0][classNo]);\n\n          if (data[0][classNo] > 0.97) {\n            if (!flag) {\n              countAudio.play();\n              setStartingTime(new Date(Date()).getTime());\n              flag = true;\n            }\n\n            setCurrentTime(new Date(Date()).getTime());\n            skeletonColor = 'rgb(0,255,0)';\n          } else {\n            flag = false;\n            skeletonColor = 'rgb(255,255,255)';\n            countAudio.pause();\n            countAudio.currentTime = 0;\n          }\n        });\n      } catch (err) {\n        console.log(err);\n      }\n    }\n  };\n\n  function startYoga() {\n    setIsStartPose(true);\n    runMovenet();\n  }\n\n  function stopPose() {\n    setIsStartPose(false);\n    clearInterval(interval);\n  }\n\n  if (isStartPose) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative flex flex-col items-center justify-center min-h-screen bg-gray-100\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col items-center mb-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-white shadow-lg rounded-lg p-6 w-80 text-center mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"text-xl font-semibold text-gray-800\",\n            children: [\"Pose Time: \", poseTime, \" s\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"text-xl font-semibold text-gray-800\",\n            children: [\"Best: \", bestPerform, \" s\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Webcam, {\n          width: \"640px\",\n          height: \"480px\",\n          id: \"webcam\",\n          ref: webcamRef,\n          className: \"absolute z-10\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          id: \"my-canvas\",\n          width: \"640px\",\n          height: \"480px\",\n          className: \"absolute z-20\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center mt-4\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: poseImages[currentPose],\n            alt: currentPose,\n            className: \"w-32 h-32 rounded-lg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: stopPose,\n        className: \"bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400\",\n        children: \"Stop Pose\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative flex flex-col items-center justify-center min-h-screen bg-gray-100\",\n    children: [/*#__PURE__*/_jsxDEV(DropDown, {\n      poseList: poseList,\n      currentPose: currentPose,\n      setCurrentPose: setCurrentPose,\n      setPoseTime: setPoseTime,\n      setBestPerform: setBestPerform\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Instructions, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startYoga,\n      className: \"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400\",\n      children: \"Start Pose\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 223,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Yoga, \"3BsscUdXQO58KxrF3rzPCTXFSjU=\");\n\n_c = Yoga;\nexport default Yoga;\n\nvar _c;\n\n$RefreshReg$(_c, \"Yoga\");","map":{"version":3,"sources":["/Users/griffin/Desktop/Github/Assana-Mate/Web/src/pages/Yoga/Yoga.js"],"names":["poseDetection","tf","React","useRef","useState","useEffect","backend","Webcam","count","Instructions","DropDown","poseImages","POINTS","keypointConnections","drawPoint","drawSegment","skeletonColor","poseList","interval","flag","Yoga","webcamRef","canvasRef","startingTime","setStartingTime","currentTime","setCurrentTime","poseTime","setPoseTime","bestPerform","setBestPerform","currentPose","setCurrentPose","isStartPose","setIsStartPose","timeDiff","CLASS_NO","Chair","Cobra","Dog","No_Pose","Shoulderstand","Traingle","Tree","Warrior","get_center_point","landmarks","left_bodypart","right_bodypart","left","gather","right","center","add","mul","get_pose_size","torso_size_multiplier","hips_center","LEFT_HIP","RIGHT_HIP","shoulders_center","LEFT_SHOULDER","RIGHT_SHOULDER","torso_size","norm","sub","pose_center_new","expandDims","broadcastTo","d","max_dist","max","pose_size","maximum","normalize_pose_landmarks","pose_center","div","landmarks_to_embedding","embedding","reshape","runMovenet","detectorConfig","modelType","movenet","SINGLEPOSE_THUNDER","detector","createDetector","SupportedModels","MoveNet","poseClassifier","loadLayersModel","countAudio","Audio","loop","setInterval","detectPose","current","video","readyState","notDetected","pose","estimatePoses","ctx","getContext","clearRect","width","height","keypoints","input","map","keypoint","score","name","x","y","connections","forEach","connection","conName","toUpperCase","err","processedInput","classification","predict","array","then","data","classNo","console","log","play","Date","getTime","pause","startYoga","stopPose","clearInterval"],"mappings":"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","sourcesContent":["import * as poseDetection from '@tensorflow-models/pose-detection';\nimport * as tf from '@tensorflow/tfjs';\nimport React, { useRef, useState, useEffect } from 'react';\nimport backend from '@tensorflow/tfjs-backend-webgl';\nimport Webcam from 'react-webcam';\nimport { count } from '../../utils/music';\nimport Instructions from '../../components/Instrctions/Instructions';\nimport DropDown from '../../components/DropDown/DropDown';\nimport { poseImages } from '../../utils/pose_images';\nimport { POINTS, keypointConnections } from '../../utils/data';\nimport { drawPoint, drawSegment } from '../../utils/helper';\n\nlet skeletonColor = 'rgb(255,255,255)';\nlet poseList = [\n  'Tree', 'Chair', 'Cobra', 'Warrior', 'Dog',\n  'Shoulderstand', 'Traingle'\n];\n\nlet interval;\nlet flag = false;\n\nfunction Yoga() {\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  const [startingTime, setStartingTime] = useState(0);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [poseTime, setPoseTime] = useState(0);\n  const [bestPerform, setBestPerform] = useState(0);\n  const [currentPose, setCurrentPose] = useState('Tree');\n  const [isStartPose, setIsStartPose] = useState(false);\n\n  useEffect(() => {\n    const timeDiff = (currentTime - startingTime) / 1000;\n    if (flag) {\n      setPoseTime(timeDiff);\n    }\n    if ((currentTime - startingTime) / 1000 > bestPerform) {\n      setBestPerform(timeDiff);\n    }\n  }, [currentTime]);\n\n  useEffect(() => {\n    setCurrentTime(0);\n    setPoseTime(0);\n    setBestPerform(0);\n  }, [currentPose]);\n\n  const CLASS_NO = {\n    Chair: 0,\n    Cobra: 1,\n    Dog: 2,\n    No_Pose: 3,\n    Shoulderstand: 4,\n    Traingle: 5,\n    Tree: 6,\n    Warrior: 7,\n  };\n\n  function get_center_point(landmarks, left_bodypart, right_bodypart) {\n    let left = tf.gather(landmarks, left_bodypart, 1);\n    let right = tf.gather(landmarks, right_bodypart, 1);\n    const center = tf.add(tf.mul(left, 0.5), tf.mul(right, 0.5));\n    return center;\n  }\n\n  function get_pose_size(landmarks, torso_size_multiplier = 2.5) {\n    let hips_center = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP);\n    let shoulders_center = get_center_point(landmarks, POINTS.LEFT_SHOULDER, POINTS.RIGHT_SHOULDER);\n    let torso_size = tf.norm(tf.sub(shoulders_center, hips_center));\n    let pose_center_new = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP);\n    pose_center_new = tf.expandDims(pose_center_new, 1);\n\n    pose_center_new = tf.broadcastTo(pose_center_new, [1, 17, 2]);\n    let d = tf.gather(tf.sub(landmarks, pose_center_new), 0, 0);\n    let max_dist = tf.max(tf.norm(d, 'euclidean', 0));\n\n    let pose_size = tf.maximum(tf.mul(torso_size, torso_size_multiplier), max_dist);\n    return pose_size;\n  }\n\n  function normalize_pose_landmarks(landmarks) {\n    let pose_center = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP);\n    pose_center = tf.expandDims(pose_center, 1);\n    pose_center = tf.broadcastTo(pose_center, [1, 17, 2]);\n    landmarks = tf.sub(landmarks, pose_center);\n\n    let pose_size = get_pose_size(landmarks);\n    landmarks = tf.div(landmarks, pose_size);\n    return landmarks;\n  }\n\n  function landmarks_to_embedding(landmarks) {\n    landmarks = normalize_pose_landmarks(tf.expandDims(landmarks, 0));\n    let embedding = tf.reshape(landmarks, [1, 34]);\n    return embedding;\n  }\n\n  const runMovenet = async () => {\n    const detectorConfig = { modelType: poseDetection.movenet.modelType.SINGLEPOSE_THUNDER };\n    const detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet, detectorConfig);\n    const poseClassifier = await tf.loadLayersModel('https://models.s3.jp-tok.cloud-object-storage.appdomain.cloud/model.json');\n    const countAudio = new Audio(count);\n    countAudio.loop = true;\n    interval = setInterval(() => {\n      detectPose(detector, poseClassifier, countAudio);\n    }, 100);\n  };\n\n  const detectPose = async (detector, poseClassifier, countAudio) => {\n    if (\n      typeof webcamRef.current !== 'undefined' &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      let notDetected = 0;\n      const video = webcamRef.current.video;\n      const pose = await detector.estimatePoses(video);\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      try {\n        const keypoints = pose[0].keypoints;\n        let input = keypoints.map((keypoint) => {\n          if (keypoint.score > 0.4) {\n            if (!(keypoint.name === 'left_eye' || keypoint.name === 'right_eye')) {\n              drawPoint(ctx, keypoint.x, keypoint.y, 8, 'rgb(255,255,255)');\n              let connections = keypointConnections[keypoint.name];\n              try {\n                connections.forEach((connection) => {\n                  let conName = connection.toUpperCase();\n                  drawSegment(\n                    ctx,\n                    [keypoint.x, keypoint.y],\n                    [keypoints[POINTS[conName]].x, keypoints[POINTS[conName]].y],\n                    skeletonColor\n                  );\n                });\n              } catch (err) {}\n            }\n          } else {\n            notDetected += 1;\n          }\n          return [keypoint.x, keypoint.y];\n        });\n        if (notDetected > 4) {\n          skeletonColor = 'rgb(255,255,255)';\n          return;\n        }\n        const processedInput = landmarks_to_embedding(input);\n        const classification = poseClassifier.predict(processedInput);\n\n        classification.array().then((data) => {\n          const classNo = CLASS_NO[currentPose];\n          console.log(data[0][classNo]);\n          if (data[0][classNo] > 0.97) {\n            if (!flag) {\n              countAudio.play();\n              setStartingTime(new Date(Date()).getTime());\n              flag = true;\n            }\n            setCurrentTime(new Date(Date()).getTime());\n            skeletonColor = 'rgb(0,255,0)';\n          } else {\n            flag = false;\n            skeletonColor = 'rgb(255,255,255)';\n            countAudio.pause();\n            countAudio.currentTime = 0;\n          }\n        });\n      } catch (err) {\n        console.log(err);\n      }\n    }\n  };\n\n  function startYoga() {\n    setIsStartPose(true);\n    runMovenet();\n  }\n\n  function stopPose() {\n    setIsStartPose(false);\n    clearInterval(interval);\n  }\n\n  if (isStartPose) {\n    return (\n      <div className=\"relative flex flex-col items-center justify-center min-h-screen bg-gray-100\">\n        <div className=\"flex flex-col items-center mb-8\">\n          <div className=\"bg-white shadow-lg rounded-lg p-6 w-80 text-center mb-4\">\n            <h4 className=\"text-xl font-semibold text-gray-800\">Pose Time: {poseTime} s</h4>\n            <h4 className=\"text-xl font-semibold text-gray-800\">Best: {bestPerform} s</h4>\n          </div>\n          <Webcam\n            width=\"640px\"\n            height=\"480px\"\n            id=\"webcam\"\n            ref={webcamRef}\n            className=\"absolute z-10\"\n          />\n          <canvas\n            ref={canvasRef}\n            id=\"my-canvas\"\n            width=\"640px\"\n            height=\"480px\"\n            className=\"absolute z-20\"\n          ></canvas>\n          <div className=\"flex justify-center mt-4\">\n            <img src={poseImages[currentPose]} alt={currentPose} className=\"w-32 h-32 rounded-lg\" />\n          </div>\n        </div>\n        <button\n          onClick={stopPose}\n          className=\"bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400\"\n        >\n          Stop Pose\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative flex flex-col items-center justify-center min-h-screen bg-gray-100\">\n      <DropDown\n        poseList={poseList}\n        currentPose={currentPose}\n        setCurrentPose={setCurrentPose}\n        setPoseTime={setPoseTime}\n        setBestPerform={setBestPerform}\n      />\n      <Instructions />\n      <button\n        onClick={startYoga}\n        className=\"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400\"\n      >\n        Start Pose\n      </button>\n    </div>\n  );\n}\n\nexport default Yoga;\n"]},"metadata":{},"sourceType":"module"}